<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of solveCobraMILP</title>
  <meta name="keywords" content="solveCobraMILP">
  <meta name="description" content="solveCobraMILP Solve constraint-based MILP problems">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html cobra --><!-- menu.html solvers -->
<h1>solveCobraMILP
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>solveCobraMILP Solve constraint-based MILP problems</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function solution = solveCobraMILP(MILPproblem,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">solveCobraMILP Solve constraint-based MILP problems

 solution = solveCobraMILP(MILPproblem,parameters)

INPUT
 MILPproblem
  A      LHS matrix
  b      RHS vector
  c      Objective coeff vector
  lb     Lower bound vector
  ub     Upper bound vector
  osense Objective sense (-1 max, +1 min)
  csense Constraint senses, a string containting the constraint sense for
         each row in A ('E', equality, 'G' greater than, 'L' less than).
  vartype Variable types ('C' continuous, 'I' integer, 'B' binary)
  x0      Initial solution

OPTIONAL INPUTS
 Optional parameters can be entered using parameters structure or as
 parameter followed by parameter value: i.e. ,'printLevel',3)

 parameters    Structure containing optional parameters.
  timeLimit    Global solver time limit
  intTol       Integrality tolerance
  relMipGapTol Relative MIP gap tolerance
  logFile      Log file (for CPLEX)
  printLevel    Printing level
               = 0    Silent (Default)
               = 1    Warnings and Errors
               = 2    Summary information 
               = 3    More detailed information
  saveInput    Saves LPproblem to filename specified in field. 
               i.e. parameters.saveInput = 'LPproblem.mat';
               Setting parameters = 'default' uses default setting set in
               getCobraSolverParameters.

 The solver is defined in the CBT_MILP_SOLVER global variable
 (set using changeCobraSolver). Solvers currently available are 
 'tomlab_cplex' and 'glpk'

OUTPUT
 solution Structure containing the following fields describing a MILP
          solution
  cont     Continuous solution
  int      Integer solution
  full     Full MILP solution vector
  obj      Objective value
  solver   Solver used to solve MILP problem
  stat     Solver status in standardized form (see below)
            1  Optimal solution found
            2  Unbounded solution
            0  Infeasible MILP
           -1  No integer solution exists
            3  Other problem (time limit etc, but integer solution exists)
  origStat Original status returned by the specific solver 
  time     Solve time in seconds


 Markus Herrgard 1/23/07</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../cobra/external/BuildMPS/BuildMPS.html" class="code" title="function [Contain OK]=BuildMPS(A, b, Aeq, beq, cost, L, U, PbName, varargin)">BuildMPS</a>	</li><li><a href="getCobraSolverParams.html" class="code" title="function varargout = getCobraSolverParams(solverType, paramNames, parameters)">getCobraSolverParams</a>	This function gets the specified parameters in paramNames from</li><li><a href="../../cobra/tools/columnVector.html" class="code" title="function vec = columnVector(vec)">columnVector</a>	columnVector Converts a vector to a column vector</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../cobra/OMNI.html" class="code" title="function [OMNISol,bilevelMILPProblem] = OMNI(model, selectedRxnList, options, constrOpt, measOpt, prevSolutions, verbFlag)">OMNI</a>	</li><li><a href="../../cobra/design/GDLS.html" class="code" title="function [gdlsSolution, bilevelMILPProblem, gdlsSolutionStructs] = GDLS(model, targetRxns, varargin)">GDLS</a>	GDLS (Genetic Design through Local Search) attempts to find genetic</li><li><a href="../../cobra/design/OptKnock.html" class="code" title="function [optKnockSol,bilevelMILPproblem] = OptKnock(model,selectedRxnList,options,constrOpt,prevSolutions,verbFlag,solutionFileNameTmp)">OptKnock</a>	OptKnock Run OptKnock in the most general form</li><li><a href="../../cobra/enumerateOptimalSolutions.html" class="code" title="function [solution] = enumerateOptimalSolutions(model)">enumerateOptimalSolutions</a>	enumerateOptimalSolution returns a set of optimal flux distributions</li><li><a href="../../cobra/fluxVariability.html" class="code" title="function [minFlux,maxFlux,Vmin,Vmax] = fluxVariability(model,optPercentage,osenseStr,rxnNameList,verbFlag, allowLoops)">fluxVariability</a>	fluxVariability Performs flux variablity analysis</li><li><a href="../../cobra/gapFilling/gapFind.html" class="code" title="function [allGaps,rootGaps,downstreamGaps] = gapFind(model,findNCgaps,verbFlag)">gapFind</a>	gapFind Identifies all blocked metabolites (anything downstream of a gap)</li><li><a href="../../cobra/gapFilling/growthExpMatch/growthExpMatch.html" class="code" title="function [solution]=growthExpMatch(model, KEGGFilename, compartment, iterations, dictionary, logFile, threshold)">growthExpMatch</a>	growExpMatch run the growthExpMatch algorythm</li><li><a href="../../cobra/optimizeCbModel.html" class="code" title="function FBAsolution = optimizeCbModel(model,osenseStr, minNorm, allowLoops)">optimizeCbModel</a>	optimizeCbModel Solve a flux balance analysis problem</li><li><a href="../../cobra/reconstruction/createTissueSpecificModel.html" class="code" title="function [tissueModel,Rxns] = createTissueSpecificModel(model,expressionData,proceedExp,orphan,exRxnRemove,solver,options,funcModel)">createTissueSpecificModel</a>	createTissueSpecificModel Create draft tissue specific model from mRNA expression data</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function solution = solveCobraMILP(MILPproblem,varargin)</a>
0002 <span class="comment">%solveCobraMILP Solve constraint-based MILP problems</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% solution = solveCobraMILP(MILPproblem,parameters)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%INPUT</span>
0007 <span class="comment">% MILPproblem</span>
0008 <span class="comment">%  A      LHS matrix</span>
0009 <span class="comment">%  b      RHS vector</span>
0010 <span class="comment">%  c      Objective coeff vector</span>
0011 <span class="comment">%  lb     Lower bound vector</span>
0012 <span class="comment">%  ub     Upper bound vector</span>
0013 <span class="comment">%  osense Objective sense (-1 max, +1 min)</span>
0014 <span class="comment">%  csense Constraint senses, a string containting the constraint sense for</span>
0015 <span class="comment">%         each row in A ('E', equality, 'G' greater than, 'L' less than).</span>
0016 <span class="comment">%  vartype Variable types ('C' continuous, 'I' integer, 'B' binary)</span>
0017 <span class="comment">%  x0      Initial solution</span>
0018 <span class="comment">%</span>
0019 <span class="comment">%OPTIONAL INPUTS</span>
0020 <span class="comment">% Optional parameters can be entered using parameters structure or as</span>
0021 <span class="comment">% parameter followed by parameter value: i.e. ,'printLevel',3)</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% parameters    Structure containing optional parameters.</span>
0024 <span class="comment">%  timeLimit    Global solver time limit</span>
0025 <span class="comment">%  intTol       Integrality tolerance</span>
0026 <span class="comment">%  relMipGapTol Relative MIP gap tolerance</span>
0027 <span class="comment">%  logFile      Log file (for CPLEX)</span>
0028 <span class="comment">%  printLevel    Printing level</span>
0029 <span class="comment">%               = 0    Silent (Default)</span>
0030 <span class="comment">%               = 1    Warnings and Errors</span>
0031 <span class="comment">%               = 2    Summary information</span>
0032 <span class="comment">%               = 3    More detailed information</span>
0033 <span class="comment">%  saveInput    Saves LPproblem to filename specified in field.</span>
0034 <span class="comment">%               i.e. parameters.saveInput = 'LPproblem.mat';</span>
0035 <span class="comment">%               Setting parameters = 'default' uses default setting set in</span>
0036 <span class="comment">%               getCobraSolverParameters.</span>
0037 <span class="comment">%</span>
0038 <span class="comment">% The solver is defined in the CBT_MILP_SOLVER global variable</span>
0039 <span class="comment">% (set using changeCobraSolver). Solvers currently available are</span>
0040 <span class="comment">% 'tomlab_cplex' and 'glpk'</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%OUTPUT</span>
0043 <span class="comment">% solution Structure containing the following fields describing a MILP</span>
0044 <span class="comment">%          solution</span>
0045 <span class="comment">%  cont     Continuous solution</span>
0046 <span class="comment">%  int      Integer solution</span>
0047 <span class="comment">%  full     Full MILP solution vector</span>
0048 <span class="comment">%  obj      Objective value</span>
0049 <span class="comment">%  solver   Solver used to solve MILP problem</span>
0050 <span class="comment">%  stat     Solver status in standardized form (see below)</span>
0051 <span class="comment">%            1  Optimal solution found</span>
0052 <span class="comment">%            2  Unbounded solution</span>
0053 <span class="comment">%            0  Infeasible MILP</span>
0054 <span class="comment">%           -1  No integer solution exists</span>
0055 <span class="comment">%            3  Other problem (time limit etc, but integer solution exists)</span>
0056 <span class="comment">%  origStat Original status returned by the specific solver</span>
0057 <span class="comment">%  time     Solve time in seconds</span>
0058 <span class="comment">%</span>
0059 <span class="comment">%</span>
0060 <span class="comment">% Markus Herrgard 1/23/07</span>
0061 
0062 <span class="comment">%% Process options</span>
0063 
0064 <span class="keyword">global</span> CBT_MILP_SOLVER
0065 
0066 <span class="keyword">if</span> (~isempty(CBT_MILP_SOLVER))
0067     solver = CBT_MILP_SOLVER;
0068 <span class="keyword">else</span>
0069     error(<span class="string">'No solver found.  Run changeCobraSolver'</span>);
0070 <span class="keyword">end</span>
0071 
0072 optParamNames = {<span class="string">'intTol'</span>, <span class="string">'relMipGapTol'</span>, <span class="string">'timeLimit'</span>, <span class="keyword">...</span>
0073     <span class="string">'logFile'</span>, <span class="string">'printLevel'</span>, <span class="string">'saveInput'</span>, <span class="string">'DATACHECK'</span>, <span class="string">'DEPIND'</span>, <span class="keyword">...</span>
0074     <span class="string">'feasTol'</span>, <span class="string">'optTol'</span>, <span class="string">'absMipGapTol'</span>, <span class="string">'NUMERICALEMPHASIS'</span>, <span class="string">'EleNames'</span>, <span class="keyword">...</span><span class="comment"> </span>
0075     <span class="string">'EqtNames'</span>, <span class="string">'VarNames'</span>, <span class="string">'EleNameFun'</span>, <span class="string">'EqtNameFun'</span>, <span class="string">'VarNameFun'</span>, <span class="keyword">...</span>
0076     <span class="string">'PbName'</span>, <span class="string">'MPSfilename'</span>};
0077 parameters = <span class="string">''</span>;
0078 <span class="keyword">if</span> nargin ~=1
0079     <span class="keyword">if</span> mod(length(varargin),2)==0
0080         <span class="keyword">for</span> i=1:2:length(varargin)-1
0081             <span class="keyword">if</span> ismember(varargin{i},optParamNames)
0082                 parameters.(varargin{i}) = varargin{i+1};
0083             <span class="keyword">else</span>
0084                 error([varargin{i} <span class="string">' is not a valid optional parameter'</span>]);
0085             <span class="keyword">end</span>
0086         <span class="keyword">end</span>
0087     <span class="keyword">elseif</span> strcmp(varargin{1},<span class="string">'default'</span>)
0088         parameters = <span class="string">'default'</span>;
0089     <span class="keyword">elseif</span> isstruct(varargin{1})
0090         parameters = varargin{1};
0091     <span class="keyword">else</span>
0092         display(<span class="string">'Warning: Invalid number of parameters/values'</span>)
0093         solution=[];
0094         <span class="keyword">return</span>;
0095     <span class="keyword">end</span>
0096 <span class="keyword">end</span>
0097 
0098 <span class="comment">%optional parameters</span>
0099 [solverParams.intTol, solverParams.relMipGapTol, solverParams.timeLimit, <span class="keyword">...</span>
0100     solverParams.logFile, solverParams.printLevel, saveInput, <span class="keyword">...</span>
0101     solverParams.DATACHECK, solverParams.DEPIND, solverParams.feasTol, <span class="keyword">...</span>
0102     solverParams.optTol, solverParams.absMipGapTol, <span class="keyword">...</span>
0103     solverParams.NUMERICALEMPHASIS] = <span class="keyword">...</span>
0104     <a href="getCobraSolverParams.html" class="code" title="function varargout = getCobraSolverParams(solverType, paramNames, parameters)">getCobraSolverParams</a>(<span class="string">'MILP'</span>,optParamNames(1:12), parameters);
0105 
0106 <span class="comment">%Save Input if selected</span>
0107 <span class="keyword">if</span> ~isempty(saveInput)
0108     fileName = parameters.saveInput;
0109     <span class="keyword">if</span> ~find(regexp(fileName,<span class="string">'.mat'</span>))
0110         fileName = [fileName <span class="string">'.mat'</span>];
0111     <span class="keyword">end</span>
0112     display([<span class="string">'Saving MILPproblem in '</span> fileName]);
0113     save(fileName,<span class="string">'MILPproblem'</span>)
0114 <span class="keyword">end</span>
0115 
0116 <span class="comment">% Defaults in case the solver does not return anything</span>
0117 <span class="comment">%x = [];</span>
0118 xInt = [];
0119 xCont = [];
0120 <span class="comment">%stat = -99;</span>
0121 <span class="comment">%solStat = -99;</span>
0122 
0123 [A,b,c,lb,ub,csense,osense,vartype,x0] = <span class="keyword">...</span>
0124     deal(MILPproblem.A,MILPproblem.b,MILPproblem.c,MILPproblem.lb,MILPproblem.ub,<span class="keyword">...</span>
0125     MILPproblem.csense,MILPproblem.osense,MILPproblem.vartype,MILPproblem.x0);
0126 
0127 <span class="keyword">if</span> any(~(vartype == <span class="string">'C'</span> | vartype == <span class="string">'B'</span> | vartype == <span class="string">'I'</span>))
0128     display (<span class="string">'vartype not C or B or I:  Assuming C'</span>);
0129     vartype(vartype ~= <span class="string">'C'</span> &amp; vartype ~= <span class="string">'I'</span>&amp; vartype ~= <span class="string">'B'</span>) = <span class="string">'C'</span>;
0130 <span class="keyword">end</span>
0131 
0132 t_start = clock;
0133 <span class="keyword">switch</span> solver
0134     
0135     <span class="keyword">case</span> <span class="string">'glpk'</span>
0136 <span class="comment">%% glpk</span>
0137 
0138         <span class="comment">% Set up problem</span>
0139         <span class="keyword">if</span> (isempty(csense))
0140             clear csense
0141             csense(1:length(b),1) = <span class="string">'S'</span>;
0142         <span class="keyword">else</span>
0143             csense(csense == <span class="string">'L'</span>) = <span class="string">'U'</span>;
0144             csense(csense == <span class="string">'G'</span>) = <span class="string">'L'</span>;
0145             csense(csense == <span class="string">'E'</span>) = <span class="string">'S'</span>;
0146             csense = <a href="../../cobra/tools/columnVector.html" class="code" title="function vec = columnVector(vec)">columnVector</a>(csense);
0147         <span class="keyword">end</span>
0148         params.msglev = solverParams.printLevel;
0149         params.tmlim = solverParams.timeLimit;
0150         
0151         <span class="comment">%whos csense vartype</span>
0152         csense = char(csense);
0153         vartype = char(vartype);
0154         <span class="comment">%whos csense vartype</span>
0155         
0156         <span class="comment">% Solve problem</span>
0157         [x,f,stat,extra] = glpk(c,A,b,lb,ub,csense,vartype,osense,params);
0158         <span class="comment">% Handle solution status reports</span>
0159         <span class="keyword">if</span> (stat == 5)
0160             solStat = 1; <span class="comment">% optimal</span>
0161         <span class="keyword">elseif</span> (stat == 6)
0162             solStat = 2; <span class="comment">% unbounded</span>
0163         <span class="keyword">elseif</span> (stat == 4) 
0164             solStat = 0; <span class="comment">% infeasible</span>
0165         
0166         <span class="keyword">elseif</span> (stat == 171)
0167             solStat = 1; <span class="comment">% Opt integer within tolerance</span>
0168         <span class="keyword">elseif</span> (stat == 173)
0169             solStat = 0; <span class="comment">% Integer infeas</span>
0170         <span class="keyword">elseif</span> (stat == 184)
0171             solStat = 2; <span class="comment">% Unbounded</span>
0172         <span class="keyword">elseif</span> (stat == 172)
0173             solStat = 3; <span class="comment">% Other problem, but integer solution exists</span>
0174         <span class="keyword">else</span>
0175             solStat = -1; <span class="comment">% No integer solution exists</span>
0176         <span class="keyword">end</span>
0177 
0178    <span class="keyword">case</span> <span class="string">'gurobi'</span>
0179         <span class="comment">% Free academic licenses for the Gurobi solver can be obtained from</span>
0180         <span class="comment">% http://www.gurobi.com/html/academic.html</span>
0181         <span class="comment">%</span>
0182         <span class="comment">% The code below uses Gurobi Mex to interface with Gurobi. It can be downloaded from</span>
0183         <span class="comment">% http://www.convexoptimization.com/wikimization/index.php/Gurobi_Mex:_A_MATLAB_interface_for_Gurobi</span>
0184 
0185         clear opts <span class="comment">% Use the default parameter settings</span>
0186         <span class="keyword">if</span> solverParams.printLevel == 0
0187            <span class="comment">% Version v1.10 of Gurobi Mex has a minor bug. For complete silence</span>
0188            <span class="comment">% Remove Line 736 of gurobi_mex.c: mexPrintf(&quot;\n&quot;);</span>
0189            opts.Display = 0;
0190            opts.DisplayInterval = 0;
0191         <span class="keyword">else</span>
0192            opts.Display = 1;
0193         <span class="keyword">end</span>
0194         
0195         <span class="comment">%minimum intTol for gurobi = 1e-9</span>
0196         <span class="keyword">if</span> solverParams.intTol&lt;1e-9, solverParams.intTol=1e-9; <span class="keyword">end</span>
0197         
0198         opts.TimeLimit=solverParams.timeLimit;
0199         opts.MIPGap = solverParams.relMipGapTol;
0200         opts.IntFeasTol = solverParams.intTol;
0201         opts.FeasibilityTol = solverParams.feasTol;
0202         opts.OptimalityTol = solverParams.optTol;
0203 
0204         <span class="keyword">if</span> (isempty(csense))
0205             clear csense
0206             csense(1:length(b),1) = <span class="string">'='</span>;
0207         <span class="keyword">else</span>
0208             csense(csense == <span class="string">'L'</span>) = <span class="string">'&lt;'</span>;
0209             csense(csense == <span class="string">'G'</span>) = <span class="string">'&gt;'</span>;
0210             csense(csense == <span class="string">'E'</span>) = <span class="string">'='</span>;
0211             csense = csense(:);
0212         <span class="keyword">end</span>
0213         <span class="comment">%gurobi_mex doesn't automatically cast logicals to doubles</span>
0214     c = double(c);
0215         [x,f,stat,output] = gurobi_mex(c,osense,sparse(A),b, <span class="keyword">...</span>
0216                                              csense,lb,ub,vartype,opts);
0217         <span class="keyword">if</span> stat == 2
0218            solStat = 1; <span class="comment">% Optimal solutuion found</span>
0219         <span class="keyword">elseif</span> stat == 3
0220            solStat = 0; <span class="comment">% Infeasible</span>
0221         <span class="keyword">elseif</span> stat == 5
0222            solStat = 2; <span class="comment">% Unbounded</span>
0223         <span class="keyword">elseif</span> stat == 4
0224            solStat = 0; <span class="comment">% Gurobi reports infeasible *or* unbounded</span>
0225         <span class="keyword">else</span>
0226            solStat = -1; <span class="comment">% Solution not optimal or solver problem</span>
0227         <span class="keyword">end</span>
0228 
0229     <span class="keyword">case</span> <span class="string">'tomlab_cplex'</span>
0230 <span class="comment">%% CPLEX through tomlab</span>
0231         <span class="keyword">if</span> (~isempty(csense))
0232             b_L(csense == <span class="string">'E'</span>) = b(csense == <span class="string">'E'</span>);
0233             b_U(csense == <span class="string">'E'</span>) = b(csense == <span class="string">'E'</span>);
0234             b_L(csense == <span class="string">'G'</span>) = b(csense == <span class="string">'G'</span>);
0235             b_U(csense == <span class="string">'G'</span>) = inf;
0236             b_L(csense == <span class="string">'L'</span>) = -inf;
0237             b_U(csense == <span class="string">'L'</span>) = b(csense == <span class="string">'L'</span>);
0238         <span class="keyword">elseif</span> isfield(MILPproblem, <span class="string">'b_L'</span>) &amp;&amp; isfield(MILPproblem, <span class="string">'b_U'</span>)
0239             b_L = MILPproblem.b_L;
0240             b_U = MILPproblem.b_U;
0241         <span class="keyword">else</span>
0242             b_L = b;
0243             b_U = b;
0244         <span class="keyword">end</span>
0245         intVars = (vartype == <span class="string">'B'</span>) | (vartype == <span class="string">'I'</span>);
0246         <span class="comment">%intVars</span>
0247         <span class="comment">%pause;</span>
0248         tomlabProblem = mipAssign(osense*c,A,b_L,b_U,lb,ub,x0,<span class="string">'CobraMILP'</span>,[],[],intVars);
0249         
0250         <span class="comment">% Set parameters for CPLEX</span>
0251         tomlabProblem.MIP.cpxControl.EPINT = solverParams.intTol;
0252         tomlabProblem.MIP.cpxControl.EPGAP = solverParams.relMipGapTol;
0253         tomlabProblem.MIP.cpxControl.TILIM = solverParams.timeLimit;
0254         tomlabProblem.CPLEX.LogFile = solverParams.logFile;
0255         tomlabProblem.PriLev = solverParams.printLevel;
0256         tomlabProblem.MIP.cpxControl.THREADS = 1; <span class="comment">% by default use only one thread</span>
0257         
0258 
0259         <span class="comment">% Strict numerical tolerances</span>
0260         tomlabProblem.MIP.cpxControl.DATACHECK = solverParams.DATACHECK;
0261         tomlabProblem.MIP.cpxControl.DEPIND = solverParams.DEPIND;
0262         tomlabProblem.MIP.cpxControl.EPRHS = solverParams.feasTol;
0263         tomlabProblem.MIP.cpxControl.EPOPT = solverParams.optTol;
0264         tomlabProblem.MIP.cpxControl.EPAGAP = solverParams.absMipGapTol;
0265         tomlabProblem.MIP.cpxControl.NUMERICALEMPHASIS = solverParams.NUMERICALEMPHASIS;
0266         <span class="comment">% Set initial solution</span>
0267         tomlabProblem.MIP.xIP = x0;
0268      
0269         <span class="comment">% Set up callback to print out intermediate solutions</span>
0270         <span class="comment">% only set this up if you know that you actually need these</span>
0271         <span class="comment">% results.  Otherwise do not specify intSolInd and contSolInd</span>
0272         <span class="keyword">global</span> cobraIntSolInd;
0273         <span class="keyword">global</span> cobraContSolInd;
0274         <span class="keyword">if</span>(~isfield(MILPproblem, <span class="string">'intSolInd'</span>))
0275             MILPproblem.intSolInd = [];
0276         <span class="keyword">else</span>
0277             tomlabProblem.MIP.callback(14) = 1;
0278         <span class="keyword">end</span>
0279         cobraIntSolInd = MILPproblem.intSolInd;
0280         <span class="keyword">if</span>(~isfield(MILPproblem, <span class="string">'contSolInd'</span>))
0281             MILPproblem.contSolInd = [];
0282         <span class="keyword">end</span>
0283         cobraContSolInd = MILPproblem.contSolInd;
0284         tomlabProblem.MIP.callbacks = [];
0285         tomlabProblem.PriLevOpt = 0;        
0286         
0287         
0288         <span class="comment">% Solve problem</span>
0289         Result = tomRun(<span class="string">'cplex'</span>, tomlabProblem);
0290         
0291         <span class="comment">% Get results</span>
0292         x = Result.x_k;
0293         f = osense*Result.f_k;
0294         stat = Result.Inform;
0295         <span class="keyword">if</span> (stat == 101 || stat == 102)
0296             solStat = 1; <span class="comment">% Opt integer within tolerance</span>
0297         <span class="keyword">elseif</span> (stat == 103)
0298             solStat = 0; <span class="comment">% Integer infeas</span>
0299         <span class="keyword">elseif</span> (stat == 118 || stat == 119)
0300             solStat = 2; <span class="comment">% Unbounded</span>
0301         <span class="keyword">elseif</span> (stat == 106 || stat == 106 || stat == 108 || stat == 110 || stat == 112 || stat == 114 || stat == 117)
0302             solStat = -1; <span class="comment">% No integer solution exists</span>
0303         <span class="keyword">else</span>
0304             solStat = 3; <span class="comment">% Other problem, but integer solution exists</span>
0305         <span class="keyword">end</span>
0306     <span class="keyword">case</span> <span class="string">'mps'</span>
0307         <span class="comment">%% BuildMPS</span>
0308         <span class="comment">% This calls buildMPS and generates a MPS format description of the</span>
0309         <span class="comment">% problem as the result</span>
0310         <span class="comment">% Build MPS Author: Bruno Luong</span>
0311         <span class="comment">% Interfaced with CobraToolbox by Richard Que (12/18/09)</span>
0312         display(<span class="string">'Solver set to MPS. This function will output an MPS matrix string for the MILP problem'</span>);
0313         <span class="comment">%Get optional parameters</span>
0314         [EleNames,EqtNames,VarNames,EleNameFun,EqtNameFun,VarNameFun,PbName,MPSfilename] = <span class="keyword">...</span>
0315             <a href="getCobraSolverParams.html" class="code" title="function varargout = getCobraSolverParams(solverType, paramNames, parameters)">getCobraSolverParams</a>(<span class="string">'LP'</span>,{<span class="string">'EleNames'</span>,<span class="string">'EqtNames'</span>,<span class="string">'VarNames'</span>,<span class="string">'EleNameFun'</span>,<span class="string">'EqtNameFun'</span>,<span class="string">'VarNameFun'</span>,<span class="string">'PbName'</span>,<span class="string">'MPSfilename'</span>},parameters);
0316         <span class="comment">%split A matrix for L and E csense</span>
0317         Ale = A(csense==<span class="string">'L'</span>,:);
0318         ble = b(csense==<span class="string">'L'</span>);
0319         Aeq = A(csense==<span class="string">'E'</span>,:);
0320         beq = b(csense==<span class="string">'E'</span>);
0321         <span class="comment">%create index of integer and binary variables</span>
0322         intIndex = find(vartype==<span class="string">'I'</span>);
0323         binaryIndex = find(vartype==<span class="string">'B'</span>);
0324         
0325         <span class="comment">%%%%Adapted from BuildMPS%%%%%</span>
0326         [neq nvar]=size(Aeq);
0327         nle=size(Ale,1);
0328         <span class="keyword">if</span> isempty(EleNames)
0329             EleNames=arrayfun(EleNameFun,(1:nle),<span class="string">'UniformOutput'</span>, false);
0330         <span class="keyword">end</span>
0331         <span class="keyword">if</span> isempty(EqtNames)
0332             EqtNames=arrayfun(EqtNameFun,(1:neq),<span class="string">'UniformOutput'</span>, false);
0333         <span class="keyword">end</span>
0334         <span class="keyword">if</span> isempty(VarNames)
0335             VarNames=arrayfun(VarNameFun,(1:nvar),<span class="string">'UniformOutput'</span>, false);
0336         <span class="keyword">end</span>
0337         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0338 
0339         [solution] = <a href="../../cobra/external/BuildMPS/BuildMPS.html" class="code" title="function [Contain OK]=BuildMPS(A, b, Aeq, beq, cost, L, U, PbName, varargin)">BuildMPS</a>(Ale, ble, Aeq, beq, c, lb, ub, PbName,<span class="string">'MPSfilename'</span>,MPSfilename,<span class="string">'EqtNames'</span>,EqtNames,<span class="string">'VarNameFun'</span>,VarNameFun,<span class="string">'Integer'</span>,intIndex,<span class="string">'Binary'</span>,binaryIndex);
0340   
0341         <span class="keyword">return</span>
0342     <span class="keyword">otherwise</span>
0343         error([<span class="string">'Unknown solver: '</span> solver]);
0344 <span class="keyword">end</span>
0345 t = etime(clock, t_start);
0346 
0347 <span class="comment">%% Store results</span>
0348 <span class="keyword">if</span> ~strcmp(solver,<span class="string">'mps'</span>)
0349     <span class="keyword">if</span> (~isempty(x))
0350         <span class="comment">%xInt = x(MILPproblem.intSolInd);</span>
0351         <span class="comment">%xCont = x(MILPproblem.contSolInd);</span>
0352         xInt = x(vartype == <span class="string">'B'</span> | vartype == <span class="string">'I'</span>);
0353         xCont = x(vartype == <span class="string">'C'</span>);
0354     <span class="keyword">end</span>
0355     
0356     solution.cont = xCont;
0357     solution.int = xInt;
0358     solution.obj = f;
0359     solution.solver = solver;
0360     solution.stat = solStat;
0361     solution.origStat = stat;
0362     solution.time = t;
0363     solution.full = x;
0364     <span class="keyword">if</span>(isfield(MILPproblem, <span class="string">'intSolInd'</span>))
0365         solution.intInd = MILPproblem.intSolInd;
0366     <span class="keyword">end</span>
0367 <span class="keyword">end</span>
0368</pre></div>
<hr><address>Generated on Sun 26-Dec-2010 12:06:07 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>